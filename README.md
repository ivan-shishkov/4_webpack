# Webpack внутри Docker

Данное решение позволяет запустить [Webpack](https://webpack.js.org/) внутри Docker контейнера как на локальной машине (в режиме development), так и на удалённом сервере (в режиме production).

## Рабочее окружение

* Ubuntu 16.04
* Docker CE
* Docker Compose
* Docker Machine (для запуска webpack на удалённом сервере)
* арендованный VPS (для запуска webpack на удалённом сервере)

## Подготовка к использованию

Необходимо клонировать данный репозиторий: 

```bash

$ git clone https://github.com/ivan-shishkov/4_webpack.git

```

и перейти внутрь директории:

```bash

$ cd 4_webpack/

```

## Запуск на локальной машине в development режиме

Запуск development-сервера с функцией live reload выполняется с помощью команды:

```bash

$ sudo docker-compose up

```

Для отображения стартовой страницы необходимо открыть браузер и перейти по адресу [http://localhost:8080/](http://localhost:8080/). При любом изменении исходных файлов в директории **webpack/src** будет происходить автоматическое обновление страницы в браузере.

Для остановки development-сервера необходимо выполнить команду:

```bash

$ sudo docker-compose down

```

## Запуск на удалённом сервере

Перед запуском на удалённом сервере необходимо:

* настроить доступ к серверу через SSH-ключи
* создать пользователя с получением прав sudo без ввода пароля
* установить веб-сервер nginx

### Установка Docker на удалённый сервер

Установка Docker на удалённый сервер производится в соответствии с [руководством](https://community.vscale.io/hc/ru/community/posts/115002400569-%D0%9A%D0%B0%D0%BA-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%BD%D0%B0-%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC-%D1%85%D0%BE%D1%81%D1%82%D0%B5-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-Docker-Machine).

### Запуск в production режиме

Перед запуском необходимо скопировать все исходные файлы в директорию **prod/src**.

Затем необходимо переключить контекст на удалённый сервер:

```bash

$ eval $(docker-machine env имя_хоста)

```

и выполнить команду:

```bash

$ docker-compose -f docker-compose.prod.yml up --build

```

При этом результирующий файл **bundle.js** будет скопирован в директорию **/var/www/html** и станет доступным при обращении к нему через браузер.
